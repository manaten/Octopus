#!/usr/bin/ruby
$octopus_file = ARGV[0]
if $octopus_file == nil then
  puts 'usage: octopus <same.octopus>'
  exit
end
$octopus_base = File.expand_path(File.dirname($0))

$java_command = "java -jar ";
$java_command += $octopus_base + "/translator/translator.jar "
$java_command += " " + $octopus_file

puts "Translating code..."
$result = system($java_command)
if !$result then
  exit
end
puts "done."

$node_command = "node "

if FileTest.file?($octopus_file) then
  $node_command += File.expand_path(File.dirname($octopus_file)) + "/trans/server.js"
else
  $node_command += File.expand_path($octopus_file) + "/trans/server.js"
end
$command = 'export NODE_PATH='+$octopus_base+'/node_modules;' + $node_command

puts ""
puts "Running node.js..."
system($command)
puts ""
puts "bye."
